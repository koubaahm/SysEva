<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Welcome!{% endblock %}</title>
    <link rel="icon" src="{{ asset('images/petit_logo.png') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet">
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
        <style>
.notification-icon a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.notification-icon.open a {
    color: #FFA500; /* Orange lorsque les notifications sont ouvertes */
}

.notification-icon a.text-orange-500 {
    color: #FFA500; /* Orange lorsque les notifications sont ouvertes */
}

.notification-count-badge {
    position: absolute;
    top: -5px; 
    right: -5px;
    background-color: #FF0000;
    color: white;
    font-size: 12px;
    padding: 2px 6px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-panel {
    width: 300px;
    background: #FFFFFF;
    padding: 8px;
    box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
    border-radius: 8px;
    position: absolute;
    right: 0;
    margin-top: 8px;
    z-index: 999;
}

.notification-link {
    display: block;
    padding: 10px;
    border-radius: 4px;
    transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
    color: #333;
    text-decoration: none;
    background-image: linear-gradient(to right, #ff8a00, #ffbc00);
}

.notification-link:hover, .notification-link:focus {
    background-image: linear-gradient(to right, #ffab40, #ffcd70);
    color: #ffffff;
    box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.5);
}

.notification-link:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.75);
}
        </style>
    {% endblock %}
    <script src="//unpkg.com/alpinejs" defer></script>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    {% block head_javascripts %}
        {{ encore_entry_script_tags('app') }}
        {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}    
</head>
<body>
    <div class="flex h-screen">
        {% block sidebar %}
            {% if app.user %}
            <div class="relative flex flex-col bg-clip-border rounded-xl bg-white text-gray-700 h-[calc(100vh-2rem)] w-full max-w-[20rem] p-4 shadow-xl shadow-blue-gray-900/5">
                <div>
                  <img src="{{ asset('images/syseva.png') }}" alt="Syseva" class="mx-auto mb-4" />
                </div>
                
                <nav class="flex flex-col gap-1 min-w-[240px] p-2 font-sans text-base font-normal text-gray-700">
                  
                    <a href="{{ path('index') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                        <svg class="h-8 w-8 text-orange-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z"/>
                            <polyline points="5 12 3 12 12 3 21 12 19 12" />
                            <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
                            <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
                        </svg>
                        <span class="ml-2">Home</span>
                    </a>
                    {% if 'ROLE_CHIEF_EDITOR' in app.user.roles or 'ROLE_ADMIN' in app.user.roles or 'ROLE_SECTION_EDITOR' in app.user.roles %}
                    <a href="{{ path('ranking_list') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                    <div class="grid place-items-center mr-4">
                      <svg class="h-8 w-8 text-orange-300"  width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">  
                        <path stroke="none" d="M0 0h24v24H0z"/>  
                        <line x1="3" y1="4" x2="21" y2="4" />  
                        <path d="M4 4v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-10" />  
                        <line x1="12" y1="16" x2="12" y2="20" />  
                        <line x1="9" y1="20" x2="15" y2="20" />  
                        <path d="M8 12l3 -3l2 2l3 -3" />
                      </svg>
                    </div>
                    Ranking
                  </a>
                  {%endif%}
                  
                  {% if 'ROLE_ADMIN' in app.user.roles %}
                  <a href="{{ path('admin') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                    <div class="grid place-items-center mr-4">
                      <svg class="h-8 w-8 text-orange-300"  fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                      </svg>
                    </div>
                    Admin
                </a>
                {% endif %}

                {% if 'ROLE_ADMIN' in app.user.roles %}
                  <a href="{{ path('invite_users') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                    <div class="grid place-items-center mr-4">
                      <svg class="h-8 w-8 text-orange-300"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round">  <polygon points="3 11 22 2 13 21 11 13 3 11" /></svg>
                    </div>
                    Invite
                </a>
                {% endif %}
                
                {% if 'ROLE_SECTION_EDITOR' in app.user.roles %}
                <a href="{{ path('add_article') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                    <div class="grid place-items-center mr-4">
                        <svg class="h-8 w-8 text-orange-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z"/>
                            <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                            <line x1="12" y1="11" x2="12" y2="17" />
                            <line x1="9" y1="14" x2="15" y2="14" />
                        </svg>
                    </div>
                    Add Articles
                </a>
                {% endif %}
                
                <a href="{{ path('sections_index') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                  <div class="grid place-items-center mr-4">
                      <svg class="h-8 w-8 text-orange-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z"/>
                          <path d="M9 5H7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2V7a2 2 0 0 0 -2 -2h-2" />
                          <rect x="9" y="3" width="6" height="4" rx="2" />
                          <line x1="9" y1="12" x2="9.01" y2="12" />
                          <line x1="13" y1="12" x2="15" y2="12" />
                          <line x1="9" y1="16" x2="9.01" y2="16" />
                          <line x1="13" y1="16" x2="15" y2="16" />
                      </svg>
                  </div>
                  Section's list
              </a>
                  
             
                  <a href="{{ path('list_articles') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                    <div class="grid place-items-center mr-4">
                        <svg class="h-8 w-8 text-orange-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z"/>
                            <path d="M9 5H7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2V7a2 2 0 0 0 -2 -2h-2" />
                            <rect x="9" y="3" width="6" height="4" rx="2" />
                            <line x1="9" y1="12" x2="9.01" y2="12" />
                            <line x1="13" y1="12" x2="15" y2="12" />
                            <line x1="9" y1="16" x2="9.01" y2="16" />
                            <line x1="13" y1="16" x2="15" y2="16" />
                        </svg>
                    </div>
                    Articles List
                </a>
                
                {% if app.user %}
                      <a href="{{ path('app_logout') }}" class="flex items-center w-full p-3 rounded-lg text-start leading-tight transition-all hover:bg-orange-50 hover:bg-opacity-80 focus:bg-orange-50 focus:bg-opacity-80 active:bg-gray-50 active:bg-opacity-80 hover:text-orange-900 focus:text-orange-900 active:text-orange-900 outline-none">
                          <div class="grid place-items-center mr-4">
                              <svg class="h-8 w-8 text-orange-300" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                  <path stroke="none" d="M0 0h24v24H0z"/>
                                  <path d="M7 6a7.75 7.75 0 1 0 10 0" />
                                  <line x1="12" y1="4" x2="12" y2="12" />
                              </svg>
                          </div>
                          Logout
                      </a>
                  {% endif %}
                </nav>
                <div class="flex-grow"></div>
                <div class="flex justify-center items-center w-full">
                  <img src="{{ asset('images/univr.png') }}" class="w-1/2 max-w-none" style="object-fit: contain;" />
                  <img src="{{ asset('images/imiayearbook.jpg') }}" alt="Logo de IMIA" class="w-1/2 max-w-none" style="object-fit: contain;" />
                </div>
              </div> 
            {% endif %}
        {% endblock %}
        
        <main class="flex-grow p-4" x-data="layout">
            {% block navbar %}
                {% if app.user %}
                
<nav class="bg-gray-200 w-full flex justify-between items-center mx-auto px-5 h-20 rounded-lg">
  <div class="flex-grow"></div> <!-- Ce div pousse tout ce qui suit vers la droite -->

  <!-- Icônes de notification et de profil -->
  <div class="flex items-center space-x-4">
  
    <div class="notification-icon relative" :class="{'open': openNotifications && unreadCount == 0}">
      <a href="#" @click="toggleNotifications" class="cursor-pointer p-2 hover:bg-orange-800 rounded-full link-gradient" :class="{'text-black': unreadCount > 0, 'text-orange-500': openNotifications && unreadCount == 0}">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
      </a>
      <span x-show="unreadCount > 0" class="notification-count-badge">{{ unread_notifications|length }}</span>
      <div x-show="openNotifications" @click.away="openNotifications = false" class="absolute right-0 mt-2 p-2 w-48 bg-white shadow-lg rounded-md">
          <div class="notification-panel">
              <ul>
                  {% if unread_notifications|length == 0 %}
                      <li>No new notifications</li>
                  {% else %}
                      {% for notification in unread_notifications %}
                          <li><a href="{{ path('mark_notification_read', {'id': notification.id}) }}" class="notification-link">{{ notification.message }}</a></li>
                          {% if not loop.last %}
                              <hr class="my-1 border-gray-200">
                          {% endif %}
                      {% endfor %}
                  {% endif %}
              </ul>
          </div>
      </div>
    </div>

    <!-- Profil-->
    <a href="{{ path('profile_show') }}" class="bg-[#f89406] dark:bg-[#f89406] p-2 hover:bg-orange-800 rounded-full">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
    </a>
  </div>
</nav>
                {% endif %}
            {% endblock %}
            {% block body %}
            {% endblock %}
        </main>
    </div>

    {% block javascripts %}
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
        <script>
            $(document).ready(function() {
                $('.select2').select2({
                    width: '100%'  // This ensures that Select2 spans the full width of the form element
                });

                const successMessage = "{{ app.flashes('success')|first }}";
                if (successMessage) {
                    Swal.fire({
                        title: 'Success!',
                        text: successMessage,
                        icon: 'success',
                        confirmButtonText: 'Ok'
                    });
                }
            });
        </script>
        <script>
document.addEventListener('alpine:init', () => {
    Alpine.data('layout', () => ({
      openSection: null,
      openNotifications: false,
      unreadCount: {{ unread_notifications|length }},

      toggleNotifications() {
        this.openNotifications = !this.openNotifications;
        // Ajoutez ou retirez une classe basée sur l'état de `openNotifications`
        const notificationIcon = document.querySelector('.notification-icon a');
        if (this.openNotifications) {
          notificationIcon.classList.add('text-orange-500');
          notificationIcon.classList.remove('text-black');
          // Si ouvert et sans notifications non lues
          if (this.unreadCount === 0) {
            this.updateNotificationDisplay();
          }
        } else {
          notificationIcon.classList.add('text-black');
          notificationIcon.classList.remove('text-orange-500');
        }
      },

      updateNotificationDisplay() {
        // Mettre à jour visuellement que les notifications sont lues
        const badge = document.querySelector('.notification-count-badge');
        if (this.unreadCount > 0) {
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      },

      loadLoginForm() {
        fetch('/login')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.text();
          })
          .then(html => {
            document.getElementById('loginFormContainer').innerHTML = html;
            this.openSection = 'login';
          })
          .catch(error => {
            console.error('Error loading the login form:', error);
          });
      },

      loadAddArticleForm() {
        fetch('/add_article')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.text();
          })
          .then(html => {
            document.getElementById('addArticleFormContainer').innerHTML = html;
            this.openSection = 'addArticle';
          })
          .catch(error => {
            console.error('Error loading the add article form:', error);
          });
      }
    }));
  });
</script>
    {% endblock %}
</body>
</html>
