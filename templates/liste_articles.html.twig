{# templates/section/index.html.twig #}

{% extends 'base.html.twig' %}
{% block title %}List of Articles{% endblock %}


{% block body %}



      <div class="h-6"></div>
      <!-- Contenu de la liste des sections -->                
            <br><br>
            <div class="container mx-auto px-4 ">
            <!-- Add the dropdown for section filtering -->
            <label for="section-filter" class="block text-sm font-medium text-gray-700">Filter by Section:</label>
            <select id="section-filter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                <option value="">All Sections</option>
                {% for section in sections %}
                    <option value="{{ section.id }}">{{ section.nom }}</option>
                {% endfor %}
            </select>
            <h1 class="text-2xl font-semibold mb-5">Article's List</h1>
            {% if  'ROLE_CHIEF_EDITOR' in app.user.roles %}
            <p>Your role is Chief Editor, so you have a full access to all articles.</p>
            {% elseif 'ROLE_ADMIN' in app.user.roles %}
            <p>You are the admin so you can view all the articles to manage the articles please go to the /admin path </p>
            <div>
        
            {% elseif 'ROLE_SENIOR_EDITOR' in app.user.roles %}
            <p>You are a senior editor so you have access to all articles from your sections and the articles you have been invited for from another sections</p>
            {% elseif 'ROLE_SECTION_EDITOR' in app.user.roles %}
            <p>You are a section editor you can view and delete all articles from your section and you can also view articles you have invited for from another sections</p>
            {% elseif 'ROLE_REVIEWER' in app.user.roles %}
            <p> You can view, take a look and evaluate all these articles </p>
            {% endif %}
                <ul role="list" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
  {% for article in articles %}
    <li class="col-span-1 divide-y divide-gray-200 rounded-lg bg-gray-200 shadow article-item section-{{ article.section.id }}" onclick="handleArticleClick({{ article.id }})">
      <div class="flex flex-col p-6">
        <h3 class="text-sm font-medium text-[#f89406]">{{ article.titre }}</h3>
        <div class="mt-1 text-sm text-gray-500">PMID: {{ article.pmid }}</div>
        <div class="mt-1 text-sm text-gray-500">DOI: {{ article.doi }}</div>
        <div class="mt-1 text-sm text-gray-500">Main Author: {{ article.auteurPrincipale }}</div>
        <div class="mt-1 text-sm text-gray-500">Authors: {{ article.auteurs }}</div>
        <div class="mt-1 text-sm text-gray-500">Affiliation: {{ article.affiliation }}</div>
        <div class="mt-1 text-sm text-gray-500">Section: {{ article.section.nom }}</div>
      </div>
      <div class="-mt-px flex divide-x divide-gray-200">
        <div class="flex w-0 flex-1">
          <a href="{{ path('download_pdf', {'filename': article.pdfFileName}) }}" class="relative -mr-px inline-flex w-0 flex-1 items-center justify-center py-4 text-sm font-semibold text-gray-900 gap-x-3 rounded-bl-lg border border-transparent"
 onclick="return confirm('Are you sure you want to download this file?')">
  <span class="text-gray-900 bg-[#f89406] dark:bg-[#f89406] font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
    Download
  </span>
</a>
        </div>
        {% if 'ROLE_SECTION_EDITOR' in app.user.roles and article.section.id == app.user.MySection.id %}
        <div class="-ml-px flex w-0 flex-1">
          <a href="{{ path('delete_article', {'id': article.id}) }}" onclick="return confirm('Are you sure you want to delete this article?')" class="relative inline-flex w-0 flex-1 items-center justify-center py-4 text-sm font-semibold text-gray-900 gap-x-3 rounded-br-lg border border-transparent">
  <span class="text-gray-900 bg-[#f89406] dark:bg-[#f89406] font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2">
    Delete
  </span>
</a>

                        </div>
                        {%endif%}
                      </div>
                    </li>
                  {% else %}
                    <li>No articles found.</li>
                  {% endfor %}
                </ul>
            </div>
    
 
          
  <script>
  function handleArticleClick(articleId) {
   window.location.href = '/article/' + articleId;
  }
document.addEventListener('DOMContentLoaded', function() {
    const sectionFilter = document.getElementById('section-filter');
    const articles = document.querySelectorAll('.article-item');    
    sectionFilter.addEventListener('change', function() {
        const selectedSection = this.value;

        articles.forEach(article => {
            if (selectedSection === "" || article.classList.contains(`section-${selectedSection}`)) {
                article.style.display = 'block';
            } else {
                article.style.display = 'none';
            }
        });
    });
});
</script>

{% endblock %}